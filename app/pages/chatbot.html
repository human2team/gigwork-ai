<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>[Test] GigWork Chatbot Page</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #ffffff;
      color: #333;
    }
    .page {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 16px 24px;
      gap: 16px;
    }
    .top-row {
      display: flex;
      gap: 20px;
      flex: 1;
      min-height: 0;
    }
    .chat-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .chat-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
    }
    .chat-subtitle {
      font-size: 13px;
      color: #666;
    }
    .chat-clear-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      background: #ffffff;
      color: #666;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .chat-clear-btn:hover {
      background: #f5f5f5;
      border-color: #ff5252;
      color: #ff5252;
    }
    .chat-box {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      background: #f9f9f9;
      overflow: hidden;
      min-height: 0;
    }
    .messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .msg-row {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }
    .msg-row.bot {
      justify-content: flex-start;
    }
    .msg-row.user {
      justify-content: flex-end;
    }
    .msg-bubble {
      max-width: 70%;
      padding: 10px 14px;
      border-radius: 12px;
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 14px;
    }
    .msg-bubble.bot {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      color: #333;
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    }
    .msg-bubble.user {
      background: #2196f3;
      color: #ffffff;
      border: none;
    }
    .msg-time {
      font-size: 11px;
      color: #999;
      margin-top: 2px;
    }
    .msg-meta {
      max-width: 70%;
    }
    .input-area {
      padding: 12px 16px;
      border-top: 1px solid #e0e0e0;
      background: #ffffff;
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }
    .input-textarea {
      flex: 1;
      min-height: 40px;
      max-height: 120px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      padding: 8px 10px;
      resize: none;
      font-family: inherit;
      font-size: 14px;
    }
    .send-btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .send-btn.enabled {
      background: #2196f3;
      color: #ffffff;
    }
    .send-btn.disabled {
      background: #e0e0e0;
      color: #999999;
      cursor: not-allowed;
    }
    .quick-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .quick-btn {
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid #2196f3;
      background: transparent;
      color: #2196f3;
      font-size: 13px;
      cursor: pointer;
    }
    .quick-btn:hover {
      background: #e3f2fd;
    }

    .pref-column {
      width: 300px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .pref-card {
      flex: 1;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    .pref-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f5f5f5;
    }
    .pref-title {
      font-size: 15px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .pref-title-bar {
      width: 4px;
      height: 18px;
      background: #2196f3;
      border-radius: 2px;
    }
    .pref-reset-btn {
      padding: 5px 12px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      background: #f5f5f5;
      color: #666;
      font-size: 12px;
      cursor: pointer;
    }
    .pref-reset-btn:hover {
      background: #ffebee;
      border-color: #ff5252;
      color: #ff5252;
    }
    .pref-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 4px;
    }
    .pref-item {
      padding: 10px;
      border-radius: 8px;
      border: 2px dashed #e0e0e0;
      background: #fafafa;
      font-size: 13px;
    }
    .pref-item.has {
      border-style: solid;
    }
    .pref-label {
      font-size: 11px;
      color: #999;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .pref-value {
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .pref-empty {
      text-align: center;
      margin-top: 12px;
      font-size: 12px;
      color: #999;
    }

    .bottom-results {
      flex: 1;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      padding: 16px 20px;
      overflow-y: auto;
      background: #ffffff;
    }
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .results-title {
      font-size: 16px;
      font-weight: 700;
    }
    .results-close-btn {
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      background: #ffffff;
      font-size: 13px;
      color: #666;
      cursor: pointer;
    }
    .results-close-btn:hover {
      background: #f5f5f5;
    }
    .result-item {
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      padding: 12px;
      margin-bottom: 10px;
    }
    .result-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .result-location {
      font-size: 13px;
      color: #555;
      margin-bottom: 6px;
    }
    .result-desc {
      font-size: 13px;
      color: #333;
    }
  </style>
</head>
<body>
<div class="page">
  <div class="top-row">
    <!-- ì™¼ìª½: ì±„íŒ… ì˜ì—­ -->
    <div class="chat-column">
      <div class="chat-header">
        <div>
          <h1 class="chat-title">AI ì±—ë´‡ ì¼ìë¦¬ ê²€ìƒ‰</h1>
          <div class="chat-subtitle">ì›í•˜ì‹œëŠ” ì¡°ê±´ì„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”</div>
        </div>
        <button class="chat-clear-btn" id="clearBtn">
          ğŸ—‘ï¸ ëŒ€í™” ë‚´ì—­ ì‚­ì œ
        </button>
      </div>

      <div class="chat-box">
        <div class="messages" id="messages"></div>
        <div class="input-area">
          <textarea
            id="inputText"
            class="input-textarea"
            rows="1"
            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Enter: ì „ì†¡, Shift+Enter: ì¤„ë°”ê¿ˆ)"
          ></textarea>
          <button id="sendBtn" class="send-btn disabled">ì „ì†¡</button>
        </div>
      </div>

      <div class="quick-buttons">
        <button class="quick-btn">ê°•ë‚¨ì—ì„œ ì£¼ 5ì¼ ì„œë¹™ ì¼ìë¦¬</button>
        <button class="quick-btn">ì‹œê¸‰ 2ë§Œì› ì´ìƒ ì¹´í˜</button>
        <button class="quick-btn">ì£¼ë§ë§Œ ê°€ëŠ¥í•œ ë°°ë‹¬</button>
        <button class="quick-btn">ì¼ìë¦¬ ì¶”ì²œ ë°›ê¸°</button>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì¡°ê±´ ì¹´ë“œ -->
    <div class="pref-column">
      <div class="pref-card">
        <div class="pref-header">
          <div class="pref-title">
            <div class="pref-title-bar"></div>
            <span>ì¼ìë¦¬ ê²€ìƒ‰ ì¡°ê±´</span>
          </div>
          <button class="pref-reset-btn" id="resetPrefBtn">ì´ˆê¸°í™”</button>
        </div>
        <div class="pref-list" id="prefList"></div>
        <div class="pref-empty" id="prefEmpty">
          ì…ë ¥ëœ ì¡°ê±´ì´ ì—†ìŠµë‹ˆë‹¤.<br/>
          ì±—ë´‡ì— ì¡°ê±´ì„ ë§í•´ì£¼ì‹œë©´<br/>
          ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <!-- ì•„ë˜: ê²€ìƒ‰ ê²°ê³¼ -->
  <div class="bottom-results" id="resultsSection" style="display:none;">
    <div class="results-header">
      <div class="results-title" id="resultsTitle">ê²€ìƒ‰ ê²°ê³¼</div>
      <button class="results-close-btn" id="closeResultsBtn">ê²°ê³¼ ë‹«ê¸°</button>
    </div>
    <div id="resultsList"></div>
  </div>
</div>

<script>
  // -----------------------------
  // ìƒíƒœ
  // -----------------------------
  const CHAT_STORAGE_KEY = "html_chat_messages";
  const PREF_STORAGE_KEY = "html_chat_preferences";

  let messages = [];
  let preferences = {
    gender: null,
    age: null,
    place: null,
    work_days: null,
    start_time: null,
    end_time: null,
    hourly_wage: null,
    requirements: null,
    category: null,
    categories: null,
    job_text: null,
    person_text: null
  };
  let searchResults = [];

  const welcomeText =
    'ì•ˆë…•í•˜ì„¸ìš”! AI GigWork ì±—ë´‡ì…ë‹ˆë‹¤. ì›í•˜ì‹œëŠ” ì¼ìë¦¬ ì¡°ê±´ì„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”.\n' +
    'ì˜ˆ: "ê°•ë‚¨ì—ì„œ ì£¼ 5ì¼, ì‹œê¸‰ 15,000ì› ì´ìƒ ì„œë¹™ ì¼ìë¦¬ ì°¾ì•„ì¤˜"';

  // -----------------------------
  // ì´ˆê¸° ë¡œë“œ
  // -----------------------------
  function loadState() {
    try {
      const savedMsgs = JSON.parse(localStorage.getItem(CHAT_STORAGE_KEY) || "[]");
      const savedPrefs = JSON.parse(localStorage.getItem(PREF_STORAGE_KEY) || "null");

      messages = Array.isArray(savedMsgs) ? savedMsgs : [];
      if (!messages.length) {
        messages.push({
          text: welcomeText,
          sender: "bot",
          timestamp: new Date().toISOString()
        });
      }

      if (savedPrefs && typeof savedPrefs === "object") {
        preferences = { ...preferences, ...savedPrefs };
      }
    } catch (e) {
      messages = [{
        text: welcomeText,
        sender: "bot",
        timestamp: new Date().toISOString()
      }];
    }
  }

  // -----------------------------
  // ì €ì¥
  // -----------------------------
  function saveMessages() {
    localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(messages));
  }

  function savePreferences() {
    localStorage.setItem(PREF_STORAGE_KEY, JSON.stringify(preferences));
  }

  // -----------------------------
  // ì‹œê°„ í¬ë§·
  // -----------------------------
  function formatTime(ts) {
    try {
      const d = new Date(ts);
      return d.toLocaleTimeString("ko-KR", { hour: "2-digit", minute: "2-digit" });
    } catch {
      return "";
    }
  }

  // -----------------------------
  // ë©”ì‹œì§€ ë Œë”ë§
  // -----------------------------
  function renderMessages() {
    const box = document.getElementById("messages");
    box.innerHTML = "";
    messages.forEach((m) => {
      const row = document.createElement("div");
      row.className = "msg-row " + (m.sender === "user" ? "user" : "bot");

      const meta = document.createElement("div");
      meta.className = "msg-meta";

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble " + (m.sender === "user" ? "user" : "bot");
      bubble.textContent = m.text || "";
      meta.appendChild(bubble);

      const time = document.createElement("div");
      time.className = "msg-time";
      time.textContent = formatTime(m.timestamp);
      meta.appendChild(time);

      row.appendChild(meta);
      box.appendChild(row);
    });
    box.scrollTop = box.scrollHeight;
  }

  // -----------------------------
  // ì¡°ê±´ í¬ë§·í„° (place, category ë“±)
  // -----------------------------
  function formatConditionValue(val, key) {
    if (val === null || val === undefined) return null;

    if (typeof val === "string" || typeof val === "number") {
      return String(val);
    }

    if (Array.isArray(val)) {
      const items = val.map((item) => {
        if (key === "work_days" && (typeof item === "string" || typeof item === "number")) {
          const d = new Date(String(item));
          if (!isNaN(d.getTime())) {
            return d.toISOString().slice(0, 10);
          }
          return String(item);
        }

        if (typeof item === "object" && item !== null) {
          if ("region1" in item || "region2" in item) {
            const parts = [];
            if (item.region1) parts.push(String(item.region1));
            if (item.region2) parts.push(String(item.region2));
            return parts.join(" ");
          }
          const catKeys = Object.keys(item).filter((k) =>
            k.toLowerCase().includes("category") || k.toLowerCase().includes("cat")
          );
          if (catKeys.length > 0) {
            return catKeys.map((k) => item[k]).filter(Boolean).join(" / ");
          }
          return Object.values(item)
            .map((v) => (v == null ? "" : String(v)))
            .filter(Boolean)
            .join(" ");
        }
        return String(item);
      }).filter(Boolean);
      return items.join(", ");
    }

    if (typeof val === "object") {
      if ("region1" in val || "region2" in val) {
        const parts = [];
        if (val.region1) parts.push(String(val.region1));
        if (val.region2) parts.push(String(val.region2));
        return parts.join(" ");
      }
      const catKeys = Object.keys(val).filter((k) =>
        k.toLowerCase().includes("category") || k.toLowerCase().includes("cat")
      );
      if (catKeys.length > 0) {
        return catKeys.map((k) => val[k]).filter(Boolean).join(" / ");
      }
      return Object.values(val)
        .map((v) => (v == null ? "" : String(v)))
        .filter(Boolean)
        .join(" ");
    }

    return null;
  }

  // -----------------------------
  // ì¡°ê±´ ë Œë”ë§
  // -----------------------------
  function renderPreferences() {
    const list = document.getElementById("prefList");
    const empty = document.getElementById("prefEmpty");
    list.innerHTML = "";

    const items = [
      { key: "job_text", label: "í•˜ê³  ì‹¶ì€ ì¼" },
      { key: "person_text", label: "ë‚´ ì •ë³´" },
      { key: "place", label: "ì§€ì—­" },
      { key: "category", label: "ì§ì¢…(ë‹¨ì¼)" },
      { key: "categories", label: "ì§ì¢…(ë³µìˆ˜)" },
      { key: "work_days", label: "ê·¼ë¬´ì¼" },
      { key: "hourly_wage", label: "ì‹œê¸‰" },
      { key: "start_time", label: "ì‹œì‘ì‹œê°„" },
      { key: "end_time", label: "ì¢…ë£Œì‹œê°„" },
      { key: "gender", label: "ì„±ë³„" },
      { key: "age", label: "ë‚˜ì´" }
    ];

    const hasAny = Object.values(preferences).some((v) => v !== null && v !== "");

    items.forEach((it) => {
      let v = preferences[it.key];
      if (it.key === "hourly_wage" && v != null) {
        v = Number(v).toLocaleString() + "ì›";
      }
      if (it.key === "age" && v != null) {
        v = String(v) + "ì„¸";
      }

      const hasValue = v !== null && v !== undefined && v !== "";

      const div = document.createElement("div");
      div.className = "pref-item" + (hasValue ? " has" : "");
      div.style.borderColor = hasValue ? "#2196f320" : "#e0e0e0";
      div.style.backgroundColor = hasValue ? "#ffffff" : "#fafafa";

      const label = document.createElement("div");
      label.className = "pref-label";
      label.textContent = it.label;
      div.appendChild(label);

      const value = document.createElement("div");
      value.className = "pref-value";
      value.textContent = hasValue ? v : "ë¯¸ì…ë ¥";
      div.appendChild(value);

      list.appendChild(div);
    });

    empty.style.display = hasAny ? "none" : "block";
  }

  // -----------------------------
  // ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
  // -----------------------------
  function renderSearchResults() {
    const section = document.getElementById("resultsSection");
    const list = document.getElementById("resultsList");
    const titleEl = document.getElementById("resultsTitle");

    if (!searchResults.length) {
      section.style.display = "none";
      return;
    }

    section.style.display = "block";
    titleEl.textContent = `ê²€ìƒ‰ ê²°ê³¼ (${searchResults.length}ê°œ)`;
    list.innerHTML = "";

    searchResults.forEach((job, idx) => {
      const item = document.createElement("div");
      item.className = "result-item";

      const t = document.createElement("div");
      t.className = "result-title";
      t.textContent = job.title || `(ì œëª© ì—†ìŒ)`;
      item.appendChild(t);

      const loc = document.createElement("div");
      loc.className = "result-location";
      loc.textContent = "ğŸ“ " + (job.location || "ì§€ì—­ ì •ë³´ ì—†ìŒ");
      item.appendChild(loc);

      const desc = document.createElement("div");
      desc.className = "result-desc";
      const d = (job.description || "").slice(0, 50);
      desc.textContent = d + (job.description && job.description.length > 50 ? "..." : "");
      item.appendChild(desc);

      list.appendChild(item);
    });
  }

  // -----------------------------
  // ë©”ì‹œì§€ ì¶”ê°€
  // -----------------------------
  function addMessage(text, sender) {
    messages.push({
      text: text,
      sender: sender,
      timestamp: new Date().toISOString()
    });
    saveMessages();
    renderMessages();
  }

  // -----------------------------
  // ì„œë²„ í˜¸ì¶œ (/chat)
  // -----------------------------
  async function callChatAPI(userText) {
    const payload = {
      text: userText,
      condition: preferences,
      search: false
    };

    const res = await fetch("http://localhost:8000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      throw new Error("HTTP " + res.status);
    }

    const data = await res.json();
    console.log("ì‘ë‹µ:", data);
    return data;
  }

  // -----------------------------
  // ì‘ë‹µ ì²˜ë¦¬ (condition, llm_response, result)
  // -----------------------------
  function applyResponseToState(data) {
    // llm_response
    let llmText = "";
    const lr = data.llm_response;
    if (typeof lr === "string" || typeof lr === "number") {
      llmText = String(lr);
    } else if (lr && typeof lr === "object") {
      llmText = typeof lr.text === "string" ? lr.text : JSON.stringify(lr);
    } else {
      llmText = "ì‘ë‹µì„ ì´í•´í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
      console.warn("ì•Œ ìˆ˜ ì—†ëŠ” llm_response í˜•ì‹:", lr);
    }

    // condition
    const cond = data.condition || {};
    const newPrefs = { ...preferences };

    if ("place" in cond) {
      newPrefs.place = formatConditionValue(cond.place, "place");
    }
    if ("category" in cond) {
      // ë°°ì—´ì¼ ìˆ˜ë„ ìˆê³  ë‹¨ì¼ì¼ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ë¬¸ìì—´ë¡œ í•©ì¹¨
      const catStr = formatConditionValue(cond.category, "category");
      newPrefs.categories = catStr;
      if (!newPrefs.category) newPrefs.category = catStr;
    }
    if ("work_days" in cond) {
      newPrefs.work_days = formatConditionValue(cond.work_days, "work_days");
    }
    if ("start_time" in cond) {
      newPrefs.start_time = cond.start_time;
    }
    if ("end_time" in cond) {
      newPrefs.end_time = cond.end_time;
    }
    if ("hourly_wage" in cond) {
      newPrefs.hourly_wage = cond.hourly_wage;
    }
    if ("job_text" in cond) {
      newPrefs.job_text = cond.job_text;
    }
    if ("person_text" in cond) {
      newPrefs.person_text = cond.person_text;
    }
    if ("gender" in cond) {
      newPrefs.gender = cond.gender;
    }
    if ("age" in cond) {
      newPrefs.age = cond.age;
    }
    if ("requirements" in cond) {
      newPrefs.requirements = cond.requirements;
    }

    preferences = newPrefs;
    savePreferences();
    renderPreferences();

    // result
    if (Array.isArray(data.result) && data.result.length > 0) {
      searchResults = data.result;
      renderSearchResults();
    }

    return llmText;
  }

  // -----------------------------
  // ì „ì†¡ ì²˜ë¦¬
  // -----------------------------
  async function handleSend() {
    const inputEl = document.getElementById("inputText");
    const text = inputEl.value.trim();
    if (!text) return;

    addMessage(text, "user");
    inputEl.value = "";
    updateSendButtonState();

    try {
      const data = await callChatAPI(text);
      const botReply = applyResponseToState(data);
      addMessage(botReply, "bot");
    } catch (e) {
      console.error(e);
      addMessage("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "bot");
    }
  }

  // -----------------------------
  // ëŒ€í™” ì‚­ì œ
  // -----------------------------
  function clearHistory() {
    messages = [{
      text: welcomeText,
      sender: "bot",
      timestamp: new Date().toISOString()
    }];
    saveMessages();
    renderMessages();
  }

  // -----------------------------
  // ì¡°ê±´ ì´ˆê¸°í™”
  // -----------------------------
  function resetPreferences() {
    preferences = {
      gender: null,
      age: null,
      place: null,
      work_days: null,
      start_time: null,
      end_time: null,
      hourly_wage: null,
      requirements: null,
      category: null,
      categories: null,
      job_text: null,
      person_text: null
    };
    savePreferences();
    renderPreferences();
  }

  // -----------------------------
  // ë²„íŠ¼ í™œì„±/ë¹„í™œì„±
  // -----------------------------
  function updateSendButtonState() {
    const inputEl = document.getElementById("inputText");
    const btn = document.getElementById("sendBtn");
    if (inputEl.value.trim()) {
      btn.className = "send-btn enabled";
    } else {
      btn.className = "send-btn disabled";
    }
  }

  // -----------------------------
  // ì´ë²¤íŠ¸ ë°”ì¸ë”©
  // -----------------------------
  function bindEvents() {
    const sendBtn = document.getElementById("sendBtn");
    const clearBtn = document.getElementById("clearBtn");
    const resetPrefBtn = document.getElementById("resetPrefBtn");
    const inputEl = document.getElementById("inputText");
    const closeResultsBtn = document.getElementById("closeResultsBtn");

    sendBtn.addEventListener("click", () => {
      if (sendBtn.classList.contains("enabled")) {
        handleSend();
      }
    });

    clearBtn.addEventListener("click", clearHistory);
    resetPrefBtn.addEventListener("click", resetPreferences);
    closeResultsBtn.addEventListener("click", () => {
      searchResults = [];
      renderSearchResults();
    });

    inputEl.addEventListener("input", updateSendButtonState);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        const btn = document.getElementById("sendBtn");
        if (btn.classList.contains("enabled")) {
          handleSend();
        }
      }
    });

    document.querySelectorAll(".quick-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        inputEl.value = btn.textContent || "";
        updateSendButtonState();
        handleSend();
      });
    });
  }

  // -----------------------------
  // ì‹œì‘
  // -----------------------------
  loadState();
  renderMessages();
  renderPreferences();
  renderSearchResults();
  bindEvents();
  updateSendButtonState();
</script>
</body>
</html>
